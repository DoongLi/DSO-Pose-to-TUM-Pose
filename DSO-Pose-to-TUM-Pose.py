# DSO type  pose txt to TUM type pose txt

# DSO Pose txt (frame-index/timestamp, SE(3)(16 bit))：
# 000000 0.316568616314139 0.815604747346501 0.48432758260376 0.486166375959701 -0.389085166592704 0.577306480585748 -0.717864862360058 -5.25799597804976 -0.865099441857685 0.0388088080150378 0.500096822743329 6.2614265200988 0 0 0 1
# 000001 0.316568616314139 0.815604747346501 0.48432758260376 0.486273282833762 -0.389085166592704 0.577306480585748 -0.717864862360058 -5.25817868912928 -0.865099441857685 0.0388088080150378 0.500096822743329 6.26106071131236 0 0 0 1
# 000002 0.316568616314139 0.8156047473465 0.48432758260376 0.487390922495508 -0.389085166592704 0.577306480585748 -0.717864862360058 -5.26008852806725 -0.865099441857685 0.0388088080150377 0.500096822743329 6.25723683182551 0 0 0 1
# 000003 0.316568616314139 0.815604747346501 0.48432758260376 0.489486019734322 -0.389085166592704 0.577306480585748 -0.717864862360058 -5.26366737206127 -0.865099441857685 0.0388088080150378 0.500096822743329 6.25007054008122 0 0 0 1

# TUM Pose txt(frame-index/timestamp, tx, ty, tz, qx, qy, qz, qw)：
# 000000 0.486166375959701 -5.25799597804976 6.2614265200988 0.24452265385085586 0.4360736868719205 -0.38930120916953315 0.7736232803573093
# 000001 0.486273282833762 -5.25817868912928 6.26106071131236 0.24452265385085586 0.4360736868719205 -0.38930120916953315 0.7736232803573093
# 000002 0.487390922495508 -5.26008852806725 6.25723683182551 0.24452265385085584 0.4360736868719205 -0.3893012091695328 0.7736232803573093
# 000003 0.489486019734322 -5.26366737206127 6.25007054008122 0.24452265385085586 0.4360736868719205 -0.38930120916953315 0.7736232803573093

#EVO evaluation

# evo_ape tum poses_gt_tum.txt 1_aparment0traj.txt -a -s
# evo_traj tum 1_aparment0traj.txt --ref=poses_gt_tum.txt -p --plot_mode=xz  -a -s

import numpy as np
from pyquaternion import Quaternion  # pip install pyquaternion

# read pose txt
with open('/home/doongli/Desktop/test/tandem_replica_pose_data_with_TUM_type/room_0/poses_gt.txt', 'r') as f:
    lines = f.readlines()

#
with open('/home/doongli/Desktop/test/tandem_replica_pose_data_with_TUM_type/room_0/poses_gt_tum.txt', 'w') as f:
    for line in lines:
        # extract data
        data = line.strip().split()
        frame_id = data[0]

        # read T
        tx = float(data[4])
        ty = float(data[8])
        tz = float(data[12])

        # SE3 to Quaternion
        R = np.array([[float(data[1]), float(data[2]), float(data[3])],
                      [float(data[5]), float(data[6]), float(data[7])],
                      [float(data[9]), float(data[10]), float(data[11])]])

        q = Quaternion(matrix=R)
        qx, qy, qz, qw = q.x, q.y, q.z, q.w

        #
        f.write(f"{frame_id} {tx} {ty} {tz} {qx} {qy} {qz} {qw}\n")